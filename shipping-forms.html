<!DOCTYPE html>

<html lang="en" dir="ltr"></html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستەمی چاپکردنی فۆرمەکانی شحن</title>
    
    <!-- فۆنتی کوردی -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap RTL CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.ltr.min.css">
    
    <style>
        body {
            font-family: 'Amiri', serif;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .form-label {
            font-weight: bold;
        }
        .preview-container {
            direction: ltr;
            text-align: left;
            margin-top: 20px;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .logo-container {
            display: flex;
            align-items: center;
        }
        .logo-container img {
            max-height: 100px;
        }
        .preview-title {
            text-align: center;
            margin: 0 20px;
        }
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .preview-table th, .preview-table td {
            border: 1px solid #ddd;
            padding: 8px 12px;
        }
        .preview-table th {
            background-color: #f0f0f0;
        }
        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: none;
        }
        @media print {
            .print-hidden {
                display: none !important;
            }
            .container {
                width: 100%;
                max-width: 100%;
                margin: 0;
                padding: 0;
            }
            .preview-container {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            body {
                background-color: white;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ناونیشان -->
        <div class="card print-hidden">
            <div class="card-body text-center">
                <h1 class="card-title mb-3">سیستەمی چاپکردنی فۆرمەکانی شحن</h1>
                <p class="card-text">دروستکردنی فۆرمەکانی شحن بۆ ناردن بە ڕێگای جیاواز</p>
            </div>
        </div>

        <!-- ئاگادارکردنەوە -->
        <div id="notification" class="alert" role="alert"></div>
        
        <!-- فۆرمی زانیاریەکان -->
        <div class="card print-hidden">
            <div class="card-body">
                <h3 class="card-title mb-4">داخلکردنی زانیاریەکان</h3>
                
                <form id="shippingForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="formType" class="form-label">جۆری فۆرم:</label>
                            <select class="form-select" id="formType" required>
                                <option value="" selected disabled>تکایە هەڵبژێرە...</option>
                                <option value="dubai-air">هەوایی دووبەی</option>
                                <option value="dubai-sea">بەحری دووبەی</option>
                                <option value="guangzhou-air">هەوایی گوانژو</option>
                                <option value="guangzhou-sea">بەحری گوانژو</option>
                                <option value="yiwu-sea">بەحری یوو</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="customerSearch" class="form-label">گەڕان بە ناوی کەس یان ID:</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="customerSearch">
                                <button class="btn btn-primary" type="button" id="searchBtn">گەڕان</button>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-3">
                            <label for="cno" class="form-label">C/NO. 箱号:</label>
                            <input type="text" class="form-control" id="cno">
                        </div>
                        <div class="col-md-3">
                            <label for="customerCode" class="form-label">Customer code:</label>
                            <input type="text" class="form-control" id="customerCode" required>
                        </div>
                        <div class="col-md-6">
                            <label for="customerName" class="form-label">Customer name:</label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        <div class="col-md-3">
                            <label for="customerLogo" class="form-label">Customer LOGO:</label>
                            <input type="text" class="form-control" id="customerLogo">
                        </div>
                        <div class="col-md-3">
                            <label for="destination" class="form-label">Destination:</label>
                            <input type="text" class="form-control" id="destination" required>
                        </div>
                        <div class="col-md-6">
                            <label for="portLoading" class="form-label">Port of loading:</label>
                            <input type="text" class="form-control" id="portLoading">
                        </div>
                        <div class="col-md-6">
                            <label for="portDischarge" class="form-label">Port of discharge:</label>
                            <input type="text" class="form-control" id="portDischarge">
                        </div>
                        <div class="col-md-6">
                            <label for="commodity" class="form-label">Commodity:</label>
                            <input type="text" class="form-control" id="commodity">
                        </div>
                        <div class="col-md-6">
                            <label for="quantities" class="form-label">Quantities:</label>
                            <input type="text" class="form-control" id="quantities">
                        </div>
                        <div class="col-12 mt-4">
                            <button type="button" id="previewBtn" class="btn btn-primary">پیشاندان</button>
                            <button type="button" id="printBtn" class="btn btn-success">چاپکردن</button>
                            <button type="reset" class="btn btn-secondary">پاککردنەوە</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- پیشاندانی فۆرمەکە -->
        <div id="previewContainer" class="preview-container" style="display: none;">
            <!-- دیزاینی فۆرمەکە لێرە دادەنرێت بە داینامیکی -->
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    
    <!-- کۆدی جاڤاسکریپت -->
    <script>
        // ڕێکخستنەکانی پەیوەندی بە فایەربەیس
        const firebaseConfig = {
            apiKey: "AIzaSyC2539t0L3Zms_jd7Z_qzJrzSV2dU_viS4",
            authDomain: "persson-database.firebaseapp.com",
            projectId: "persson-database",
            storageBucket: "persson-database.firebasestorage.app",
            messagingSenderId: "1002896345987",
            appId: "1:1002896345987:web:4bb12ac4c5d13fba0c44b6",
            measurementId: "G-5PC29H4823"
        };
        
        // دەستپێکردنی فایەربەیس
        firebase.initializeApp(firebaseConfig);
        
        // گرتنی ڕیفرێنسی داتابەیس
        const db = firebase.firestore();
        const personsCollection = db.collection('persons');
        
        // فۆرماتەکانی شحن
        const shippingFormats = {
            'dubai-air': {
                title: 'Air Logistics Services - Dubai',
                subtitle: 'مستودع خدمات النقل الجوي - دبي',
                logo: 'plane.png',
                contactInfo: 'Dubai airport free-zone, block H office H24, al Qudes street, dubai, United Arab Emirates<br>Warehouse Manager: Mr. Ajmal +971 50 223 4842<br>Warehouse Operation: Mr. KIM +971 56 935 9915'
            },
            'dubai-sea': {
                title: 'Sea Logistics Dubai',
                subtitle: 'عنوان المستودع البحري في مدينة دبي',
                logo: 'ship.png',
                contactInfo: 'Al Khaleej Street near Hamriyah Port, Dubai, United Arab Emirates<br>Warehouse Manager : Mr. Mark: +971 56 414 7224<br>Sea freight manager : Mr. Abdulaziz: +971 56 402 4502'
            },
            'guangzhou-air': {
                title: 'Air Logistics Services - Guangzhou City, China',
                subtitle: '广州空运物流服务',
                logo: 'plane.png',
                contactInfo: 'Air warehouse address in china for your reference:<br>NO.6-3 First floor haiming street, BinijiangXi Road, HaiZhu area, Guangzhou, China<br>Contact Person: MR Wang, Tel.: 15989089401'
            },
            'guangzhou-sea': {
                title: 'Sea Logistics Services - Guangzhou City, China',
                subtitle: '广州海运物流服务',
                logo: 'ship.png',
                contactInfo: 'Room c21-23, zone C, baiyun lake storage park,<br>no. 1, jiaoxin avenue, baiyun district, guangzhou city<br>Working time: 10:00 - 18:30, Monday to Saturday'
            },
            'yiwu-sea': {
                title: 'Sea Logistics Services - Yiwu City, China',
                subtitle: '义乌海运物流服务',
                logo: 'ship.png',
                contactInfo: '1st floor, Building B, No.1 Pinghai Road, Jiangdong Street, Yiwu City, Zhejiang Province, China<br>Contact Person: MR Wang ,Tel.: +86-133 3592 9157'
            }
        };
        
        // کاتێک پەڕەکە ئامادە دەبێت
        document.addEventListener('DOMContentLoaded', function() {
            // بەڕێوەبردنی گەڕان
            document.getElementById('searchBtn').addEventListener('click', searchCustomer);
            
            // پیشاندانی فۆرم و چاپکردن
            document.getElementById('previewBtn').addEventListener('click', previewShippingForm);
            document.getElementById('printBtn').addEventListener('click', printShippingForm);
        });
        
        // فەنکشنی پیشاندانی ئاگادارکردنەوە
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `alert alert-${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // فەنکشنی گەڕان بە ناوی کەس
        function searchCustomer() {
            const searchValue = document.getElementById('customerSearch').value.trim();
    
    if (!searchValue) {
        showNotification('تکایە وشەی گەڕان داخل بکە', 'warning');
        return;
    }
    
    // گەڕان لە داتابەیس - پرۆمیسەکان بۆ فیلدە جیاوازەکان
    const promises = [];
    
    if (!isNaN(searchValue)) {
        // گەڕان بەپێی ID
        promises.push(personsCollection.where('Persson_ID', '==', parseInt(searchValue)).get());
    } else {
        // گەڕان بەپێی ناو
        promises.push(personsCollection.where('Naw', '>=', searchValue)
                                    .where('Naw', '<=', searchValue + '\uf8ff').get());
                                    
        // گەڕان بەپێی ناوی ئینگلیزی
        promises.push(personsCollection.where('Name_en', '>=', searchValue)
                                    .where('Name_en', '<=', searchValue + '\uf8ff').get());
                                    
        // گەڕان بەپێی لۆگۆ
        promises.push(personsCollection.where('Logo', '==', searchValue).get());
        
        // گەڕان بەپێی مۆبایل
        promises.push(personsCollection.where('Mobil', '>=', searchValue)
                                    .where('Mobil', '<=', searchValue + '\uf8ff').get());
                                    
        // گەڕان بەپێی ZMC_code
        promises.push(personsCollection.where('ZMC_code', '==', searchValue).get());
        
        // گەڕان بەپێی کۆدی کەس
        promises.push(personsCollection.where('persson_code', '==', searchValue).get());
    }
    
    // جێبەجێکردنی هەموو پرۆمیسەکان
    Promise.all(promises)
        .then((snapshots) => {
            // کۆکردنەوەی هەموو دۆکیومێنتەکان لە هەموو ئەنجامەکان
            let person = null;
            
            for (const snapshot of snapshots) {
                if (!snapshot.empty) {
                    // ئەگەر ئەنجام دۆزرایەوە، یەکەم ئەنجام هەڵدەگرین
                    person = snapshot.docs[0].data();
                    break;
                }
            }
            
            if (person) {
                // پڕکردنەوەی فۆڕمەکە
                document.getElementById('customerCode').value = person.persson_code || '';
                document.getElementById('customerName').value = person.Name_en || person.Naw || '';
                document.getElementById('customerLogo').value = person.Logo || '';
                document.getElementById('destination').value = person.Country || '';
                
                showNotification('کەس دۆزرایەوە و زانیاریەکان پڕکرانەوە', 'success');
            } else {
                showNotification('هیچ کەسێک نەدۆزرایەوە', 'warning');
            }
        })
        .catch((error) => {
            console.error("هەڵە لە گەڕان: ", error);
            showNotification('هەڵەیەک ڕوویدا لە کاتی گەڕان', 'danger');
        });
        }
        
        // فەنکشنی پیشاندانی فۆرمی شحن
        function previewShippingForm() {
            const formType = document.getElementById('formType').value;
    
    if (!formType) {
        showNotification('تکایە جۆری فۆرم هەڵبژێرە', 'warning');
        return;
    }
    
    // وەرگرتنی زانیاریەکان لە فۆڕمەکە
    const formData = {
        cno: document.getElementById('cno').value,
        customerCode: document.getElementById('customerCode').value,
        customerName: document.getElementById('customerName').value,
        customerLogo: document.getElementById('customerLogo').value,
        destination: document.getElementById('destination').value,
        portLoading: document.getElementById('portLoading').value,
        portDischarge: document.getElementById('portDischarge').value,
        commodity: document.getElementById('commodity').value,
        quantities: document.getElementById('quantities').value
    };
    
    // چێککردنی بەهاکانی پێویست
    if (!formData.customerCode || !formData.customerName || !formData.destination) {
        showNotification('تکایە زانیاریە پێویستەکان داخل بکە', 'warning');
        return;
    }
    
    // دروستکردنی HTML ی فۆرمەکە
    const formFormat = shippingFormats[formType];
    const currentDate = new Date().toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    
    // دیاریکردنی جۆری هێدەر بەپێی فۆرم
    let headerHTML = '';
    if (formType === 'dubai-air' || formType === 'dubai-sea') {
        // فۆرمەکانی دووبەی - هەردوو لۆگۆ هەبێت
        headerHTML = `
            <div class="preview-header">
                <div class="logo-container">
                    <img src="https://i.ibb.co/5W22LRrV/image.jpg" alt="Baran Cargo">
                </div>
                <div class="preview-title">
                    <h2>کۆمپانیای لوتکەی شاهۆ</h2>
                    <h2>Baran Cargo</h2>
                </div>
                <div class="logo-container">
                    <img src="https://i.ibb.co/tpGPwx8H/LS.png" alt="LS Express">
                </div>
            </div>
        `;
    } else {
        // فۆرمەکانی چین - تەنها لۆگۆی LS
        headerHTML = `
            <div class="preview-header">
                <div class="logo-container" style="width: 30%"></div>
                <div class="preview-title">
                    <h2>کۆمپانیای لوتکەی شاهۆ</h2>
                    <h2>LS Express Company</h2>
                </div>
                <div class="logo-container">
                    <img src="https://i.ibb.co/tpGPwx8H/LS.png" alt="LS Express">
                </div>
            </div>
        `;
    }
    
    let formHTML = `
        <div class="print-page">
            ${headerHTML}
            
            <div class="shipping-header" style="background-color: #e11937; color: white; padding: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center;">
                    <img src="images/burj.png" alt="Burj" style="height: 50px; margin-right: 15px;">
                </div>
                <div style="text-align: center;">
                    <h3>${formFormat.title}</h3>
                    <p>${formFormat.subtitle}</p>
                </div>
                <div style="display: flex; align-items: center;">
                    <img src="images/${formFormat.logo}" alt="Transport" style="height: 40px; margin-left: 15px;">
                </div>
            </div>
            
            <p>Applications for the provision of services and transportation of goods we are providing the first class logistics service by air and by sea world wide kindly be requested to fill in the required blanks for ease of treatment.</p>
            
            <table class="preview-table">
                <tr>
                    <th width="30%">C/NO. 箱号：</th>
                    <td>${formData.cno}</td>
                </tr>
                <tr>
                    <th>Customer code:</th>
                    <td>${formData.customerCode}</td>
                </tr>
                <tr>
                    <th>Customer name:</th>
                    <td>${formData.customerName}</td>
                </tr>
                <tr>
                    <th>Customer LOGO:</th>
                    <td>${formData.customerLogo}</td>
                </tr>
                <tr>
                    <th>Destination</th>
                    <td>${formData.destination}</td>
                </tr>
            </table>
            
            <p>Port of loading: ${formData.portLoading}</p>
            <p>Port of discharge: ${formData.portDischarge}</p>
            <p>Commodity: ${formData.commodity}</p>
            <p>Quantities: ${formData.quantities}</p>
            
            <div style="border: 1px solid #000; padding: 10px; margin: 20px 0;">
                <h4>For delivery and contact number please find below details</h4>
                <p>${formFormat.contactInfo}</p>
            </div>
            
            <div style="border: 1px solid #000; padding: 10px; margin: 20px 0;">
                <h4>Terms and conditions</h4>
                <p>Please mark the customer details with logo, contact number and final destinations.</p>
                <p>Please provide clearly the packing list with clear commodity and Quantities, country of origin and with battery or no, and should all the cargo to be declare as general cargo Does not contain dangerous substances.</p>
                <p>Our company assumes no responsibility for any incorrect information that may lead to the seizure of goods. All required information must be correct and be the responsibility of the shipping applicant. success is your success and we always aspire to develop our services to level your expectations</p>
            </div>
            
            <div style="text-align: center; margin-top: 20px; font-size: 12px; color: #777;">
                <p>Page 1 of 1                                                           ${currentDate}</p>
            </div>
        </div>
    `;
    
    // پیشاندانی فۆرمەکە
    const previewContainer = document.getElementById('previewContainer');
    previewContainer.innerHTML = formHTML;
    previewContainer.style.display = 'block';
    
    window.scrollTo({
        top: previewContainer.offsetTop,
        behavior: 'smooth'
    });
        }
        
        // فەنکشنی چاپکردن
        function printShippingForm() {
            const previewContainer = document.getElementById('previewContainer');
            
            if (previewContainer.style.display === 'none') {
                // ئەگەر پیشاندراو نەبێت، یەکەم جار پیشانی بدە
                previewShippingForm();
                
                // چاوەڕێ بکە تاکو پیشان دەدرێت، پاشان چاپی بکە
                setTimeout(() => {
                    window.print();
                }, 500);
            } else {
                // ڕاستەوخۆ چاپی بکە
                window.print();
            }
        }
    </script>
</body>
</html>